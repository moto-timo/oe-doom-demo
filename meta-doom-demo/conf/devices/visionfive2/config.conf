MACHINE = "visionfive2"
DISTRO = "doom-demo"

# ERROR: Nothing RPROVIDES 'chexquest-galactic-conflict' (but .../oe-doom-demo/core/../meta-doom-demo/recipes-images/core-image-doom/core-image-doom.bb RDEPENDS on or otherwise requires it)
# chexquest-galactic-conflict was skipped: because it has a restricted license 'nonfree'. Which is not listed in LICENSE_FLAGS_ACCEPTED
LICENSE_FLAGS_ACCEPTED += "nonfree"

# ERROR: Nothing PROVIDES 'virtual/libx11' (but .../oe-doom-demo/core/../meta-riscv/recipes-graphics/mesa/mesa-pvr_21.2.1.bb DEPENDS on or otherwise requires it)
# libx11 PROVIDES virtual/libx11 but was skipped: missing required distro feature 'x11' (not in DISTRO_FEATURES)

DISTRO_FEATURES:append:visionfive2 = " x11"

# Requires git-lfs on host
# WARNING: visionfive2-pvr-graphics-1.17-r0 do_fetch: Failed to fetch URL git://github.com/starfive-tech/soft_3rdpart.git;protocol=https;lfs=1;branch=JH7110_VisionFive2_devel;rev=cd7b50cd9f9eca66c23ebd19f06a172ce0be591f, attempting MIRRORS if available
# ERROR: visionfive2-pvr-graphics-1.17-r0 do_fetch: Fetcher failure: Repository https://github.com/starfive-tech/soft_3rdpart.git has LFS content, install git-lfs on host to download (or set lfs=0 to ignore it)
# ERROR: visionfive2-pvr-graphics-1.17-r0 do_fetch: Bitbake Fetcher Error: FetchError('Unable to fetch URL from any source.', 'git://github.com/starfive-tech/soft_3rdpart.git;protocol=https;lfs=1;branch=JH7110_VisionFive2_devel;rev=cd7b50cd9f9eca66c23ebd19f06a172ce0be591f')

# WARNING: venc-module-1.0-r0 do_populate_lic: QA Issue: venc-module: No generic license file exists for: ChipsMedia_VisionFive2 in any provider [license-exists]
# WARNING: vdec-module-1.0-r0 do_populate_lic: QA Issue: vdec-module: No generic license file exists for: ChipsMedia_VisionFive2 in any provider [license-exists]
# WARNING: linux-firmware-visionfive2-wave511-1.0-r0 do_populate_lic: QA Issue: linux-firmware-visionfive2-wave511: No generic license file exists for: ChipsMedia_VisionFive2 in any provider [license-exists]
# WARNING: jpu-module-1.0-r0 do_populate_lic: QA Issue: jpu-module: No generic license file exists for: ChipsMedia_VisionFive2 in any provider [license-exists]
# WARNING: linux-firmware-visionfive2-wave420l-1.0-r0 do_populate_lic: QA Issue: linux-firmware-visionfive2-wave420l: No generic license file exists for: ChipsMedia_VisionFive2 in any provider [license-exists]

# .../oe-doom-demo/core/../meta-riscv/recipes-kernel/modules/jpu-module.bb:do_compile
# fixdep: error opening file: arch/riscv/kernel/vdso/.rt_sigreturn.o.d: No such file or directory

# .../oe-doom-demo/core/../meta-riscv/recipes-kernel/modules/vdec-module.bb:do_compile
# fixdep: error opening file: arch/riscv/kernel/vdso/.flush_icache.o.d: No such file or directory
# fixdep: error opening file: arch/riscv/kernel/vdso/.getcpu.o.d: No such file or directory
# fixdep: error opening file: arch/riscv/kernel/vdso/.note.o.d: No such file or directory

# On second build above two recipes complete


# WARNING: gzdoom-4.10.0-r0 do_package_qa: QA Issue: gzdoom: ELF binary /usr/bin/gzdoom has relocations in .text [textrel]
# WARNING: gzdoom-4.10.0-r0 do_package_qa: QA Issue: File /usr/src/debug/gzdoom/4.10.0-r0/src/zcc-parse.c in package gzdoom-src contains reference to TMPDIR
# File /usr/src/debug/gzdoom/4.10.0-r0/src/xlat_parser.c in package gzdoom-src contains reference to TMPDIR
# File /usr/src/debug/gzdoom/4.10.0-r0/src/sc_man_scanner.h in package gzdoom-src contains reference to TMPDIR [buildpaths]

# rm: cannot remove '.../tmp-glibc/work/riscv64-oe-linux/opensbi/1.2-r0/image/include': No such file or directory

# oe-doom-demo/core$ git diff meta/recipes-bsp/opensbi/opensbi_1.2.bb
#diff --git a/meta/recipes-bsp/opensbi/opensbi_1.2.bb b/meta/recipes-bsp/opensbi/opensbi_1.2.bb
#index a088fef419..0555abafe8 100644
#--- a/meta/recipes-bsp/opensbi/opensbi_1.2.bb
#+++ b/meta/recipes-bsp/opensbi/opensbi_1.2.bb
#@@ -24,9 +24,9 @@ do_compile[depends] += "${@riscv_get_do_compile_depends(d)}"
# do_install:append() {
#         # In the future these might be required as a dependency for other packages.
#	         # At the moment just delete them to avoid warnings
#		 -       rm -r ${D}/include
#		 -       rm -r ${D}/lib*
#		 -       rm -r ${D}/share/opensbi/*/${RISCV_SBI_PLAT}/firmware/payloads
#		 +       rm -rf ${D}/include
#		 +       rm -rf ${D}/lib*
#		 +       rm -rf ${D}/share/opensbi/*/${RISCV_SBI_PLAT}/firmware/payloads
#		  }
#
#		    do_deploy () {

# install: cannot stat '.../tmp-glibc/work/riscv64-oe-linux/opensbi/1.2-r0/image/share/opensbi/*/generic/firmware/fw_payload.*': No such file or directory
